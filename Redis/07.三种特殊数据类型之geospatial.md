# geospatial

两地之间的距离，方圆几百里的人

## 一共六个命令

- geoadd
- geodist
- geohash
- geopos
- georadius
- georadiusbymember

> geoadd（添加地理位置）

```bash
##########################################################
#geoadd 添加位置（正常通过程序导入）
# 参数: key 经度 纬度 名称（经度必须在维度之前）
# 有效的经度从-180度到180度。
# 有效的纬度从-85.05112878度到85.05112878度。
127.0.0.1:6379> geoadd china:city 116.40 39.90 beijing
(integer) 1
127.0.0.1:6379> geoadd china:city 121.47 31.23 shanghai
(integer) 1
127.0.0.1:6379> geoadd china:city 106.50 29.53 chongqing
(integer) 1
127.0.0.1:6379> geoadd china:city 114.05 22.52 shengzhen
(integer) 1
127.0.0.1:6379> geoadd china:city 120.16 30.24 hangzhou 108.96 34.26 xian
(integer) 2
127.0.0.1:6379>  
##########################################################
```



> geopos（返回给定位置的经度纬度）

```bash
##########################################################
# geopos
127.0.0.1:6379> geopos china:city beijing
1) 1) "116.39999896287918"
   2) "39.900000091670925"
127.0.0.1:6379> geopos china:city chongqing shengzhen
1) 1) "106.49999767541885"
   2) "29.529999579006592"
2) 1) "114.04999762773514"
   2) "22.520000087950386"
127.0.0.1:6379> 
##########################################################
```



> geodist （返回两个位置间的绝对路劲）

单位：

* m 表示米
* km 表示千米、
* mi 表示英里
* ft 表示英尺

```bash
##########################################################
127.0.0.1:6379> geodist china:city beijing shanghai
"1067378.7564"
127.0.0.1:6379> geodist china:city beijing shanghai km  # 用km表示
"1067.3788"
127.0.0.1:6379> 
##########################################################
```



> georadius 以给定的经度纬度为中心，查询某一半径内的元素

查看附近的人（一般通过半径查询）

- `WITHDIST` ： 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。
- `WITHCOORD` ： 将位置元素的经度和维度也一并返回。
- `WITHHASH` ： 以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。 这个选项主要用于底层应用或者调试， 实际中的作用并不大。

```bash
##########################################################
127.0.0.1:6379> georadius china:city 110 30 1000 km  # 以经度110，纬度30的地方为圆心，半径为1000km查找
1) "chongqing"
2) "xian"
3) "shengzhen"
4) "hangzhou"
127.0.0.1:6379> georadius china:city 110 30 500 km
1) "chongqing"
2) "xian"
127.0.0.1:6379> georadius china:city 110 30 500 km withcoord withdist withhash count 1 #count表示的是显示查找的数量
1) 1) "chongqing"
   2) "341.9374"   # WITHDIST 在返回位置元素的同时，将位置元素与中心之间的距离也一并返回。距离的单位和用户给定的范围单位保持一致。
   3) (integer) 4026042091628984 # WITHHASH :作用不大
   4) 1) "106.49999767541885"
      2) "29.529999579006592"
127.0.0.1:6379>  georadius china:city 110 30 500 km withcoord withdist withhash count 2
1) 1) "chongqing"
   2) "341.9374"
   3) (integer) 4026042091628984
   4) 1) "106.49999767541885"
      2) "29.529999579006592"
2) 1) "xian"
   2) "483.8340"
   3) (integer) 4040115445396757
   4) 1) "108.96000176668167"
      2) "34.2599996441893"
##########################################################
```



> georadiusbymember

根据指定城市，按照半径找出这个城市周围其它城市

```bash
##########################################################
127.0.0.1:6379>  georadiusbymember china:city beijing 1000 km
1) "beijing"
2) "xian"
127.0.0.1:6379>
##########################################################
```



> geohash

返回11个字符串的Geohash字符串

```bash
# 将二维的经纬度转换为一维的字符串，如果两个字符串越接近，那么距离越近
127.0.0.1:6379> geohash china:city beijing xian
1) "wx4fbxxfke0"
2) "wqj6zky6bn0"
```



> Geo的底层实现原理其实就是Zset，可以使用Zset操作

```bash
##########################################################
# 这样删除的操作就可以做了
127.0.0.1:6379> zrange china:city 0 -1 
1) "chongqing"
2) "xian"
3) "shengzhen"
4) "hangzhou"
5) "shanghai"
6) "beijing"
127.0.0.1:6379> zrem china:city shengzhen
(integer) 1
127.0.0.1:6379> zrange china:city 0 -1
1) "chongqing"
2) "xian"
3) "hangzhou"
4) "shanghai"
5) "beijing"
127.0.0.1:6379>  
##########################################################
```

